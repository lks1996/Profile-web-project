<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ïù¥Î†•ÏÑú Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ (Profile Editor)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/profile-editor.css}">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body class="container py-5">

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="fw-bold text-primary"><i class="bi bi-person-lines-fill"></i> Ïù¥Î†•ÏÑú Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h1>
    <a href="/admin/profiles" class="btn btn-outline-secondary" target="_self">Ïù¥Î†•ÏÑú Î™©Î°ù<i class="bi bi-box-arrow-up-right"></i></a>
    <a href="/" class="btn btn-outline-secondary" target="_blank">ÎÇ¥ Ïù¥Î†•ÏÑú Î≥¥Í∏∞ <i class="bi bi-box-arrow-up-right"></i></a>
</div>

<div th:if="${param.saved}" class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
    <strong><i class="bi bi-check-circle-fill"></i> Ï†ÄÏû• ÏôÑÎ£å!</strong> Î™®Îì† Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ Î∞òÏòÅÎêòÏóàÏäµÎãàÎã§.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<form th:action="@{|/admin/profile/${profileId}/save|}" th:object="${wrapper}" method="post" id="profileForm">

    <div id="mainSectionList" class="sortable-list-root">

        <div th:each="sec, secStat : *{sections}" class="section-card mb-4 bg-white shadow-sm p-4 list-item-root position-relative">

            <div class="section-header d-flex align-items-center justify-content-between mb-3 border-bottom pb-2">
                <div class="d-flex align-items-center">
                    <i class="bi bi-arrows-move drag-handle-root fs-4 me-3" title="ÏàúÏÑú Î≥ÄÍ≤Ω"></i>
                    <h4 class="mb-0 fw-bold text-dark"
                        th:text="${secStat.count + '. ' + (sec.sectionName != null ? sec.sectionName : sec.sectionType)}">
                        1. ÏÑπÏÖòÎ™Ö
                    </h4>
                </div>

                <div class="d-flex align-items-center">
                    <span class="badge bg-light text-secondary border me-2">SECTION VISIBILITY</span>
                    <div class="form-check form-switch fs-5 mb-0">
                        <input class="form-check-input" type="checkbox" role="switch"
                               th:checked="${sec.visible}"
                               onchange="this.nextElementSibling.value = this.checked"
                               title="Ïù¥ ÏÑπÏÖòÏùÑ Ïù¥Î†•ÏÑúÏóê ÌëúÏãúÌï†ÏßÄ ÏÑ§Ï†ïÌï©ÎãàÎã§.">
                        <input type="hidden" th:field="*{sections[__${secStat.index}__].visible}">
                    </div>
                </div>

                <input type="hidden" th:if="${sec.id != null}" th:field="*{sections[__${secStat.index}__].id}">
                <input type="hidden" th:field="*{sections[__${secStat.index}__].sectionName}">
                <input type="hidden" th:field="*{sections[__${secStat.index}__].sectionType}">
                <input type="hidden" class="root-sort-order" th:field="*{sections[__${secStat.index}__].sortOrder}">
            </div>

            <div th:if="${sec.sectionType.name() == 'ABOUT'}">
                <div class="row g-3">
                    <input type="hidden" th:field="*{config.id}">
                    <div class="col-md-6"><label class="form-label fw-bold text-muted small">Ïù¥Î¶Ñ</label><input type="text" th:field="*{config.fullName}" class="form-control" placeholder="ÌôçÍ∏∏Îèô"></div>
                    <div class="col-md-6"><label class="form-label fw-bold text-muted small">ÏßÅÎ¨¥ ÌÉÄÏù¥ÌãÄ</label><input type="text" th:field="*{config.companyRoleLabel}" class="form-control" placeholder="Backend Developer"></div>
                    <div class="col-md-4"><label class="form-label text-muted small">Ï†ÑÌôîÎ≤àÌò∏</label><input type="text" th:field="*{config.phone}" class="form-control"></div>
                    <div class="col-md-4"><label class="form-label text-muted small">Ïù¥Î©îÏùº</label><input type="email" th:field="*{config.email}" class="form-control"></div>
                    <div class="col-md-4"><label class="form-label text-muted small">ÎßÅÌÅ¨ (GitHub/Blog)</label><input type="text" th:field="*{config.github}" class="form-control"></div>
                    <div class="col-12"><label class="form-label fw-bold text-muted small">ÏûêÍ∏∞ÏÜåÍ∞ú Î≥∏Î¨∏</label><textarea th:field="*{config.aboutParagraph}" class="form-control" rows="4"></textarea></div>
                </div>

                <div class="mt-4">
                    <label class="form-label fw-bold mb-2">üìå Ï£ºÏöî Í≤ΩÌóò ÏöîÏïΩ (Key Experience)</label>
                    <div id="keyRoleList" class="sortable-list">
                        <div th:each="role, rStat : *{keyRoles}" class="list-item key-role-item d-flex align-items-center mb-2 bg-white p-2 border rounded">
                            <i class="bi bi-grip-vertical drag-handle me-2 text-secondary"></i>
                            <input type="hidden" th:field="*{keyRoles[__${rStat.index}__].id}">
                            <input type="hidden" class="sort-order" th:field="*{keyRoles[__${rStat.index}__].sortOrder}">

                            <div class="flex-grow-1 me-2">
                                <textarea th:field="*{keyRoles[__${rStat.index}__].roleContent}" class="form-control border-0 bg-transparent" rows="2" placeholder="ÌïµÏã¨ Í≤ΩÌóòÏùÑ ÏöîÏïΩÌï¥ÏÑú ÏûëÏÑ±ÌïòÏÑ∏Ïöî"></textarea>
                            </div>

                            <div class="form-check form-switch me-2" title="ÎÖ∏Ï∂ú Ïó¨Î∂Ä">
                                <input class="form-check-input" type="checkbox"
                                       th:checked="${role.visible}"
                                       onchange="this.nextElementSibling.value = this.checked">
                                <input type="hidden" th:field="*{keyRoles[__${rStat.index}__].visible}">
                            </div>

                            <button type="button" class="btn btn-outline-danger btn-sm border-0" onclick="removeElement(this)">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-link px-0 text-decoration-none" onclick="addKeyRole()">
                        <i class="bi bi-plus-circle"></i> Í≤ΩÌóò Ìïú Ï§Ñ Ï∂îÍ∞Ä
                    </button>
                </div>
            </div>

            <div th:if="${sec.sectionType.name() == 'PROJECTS'}">
                <div id="companyList" class="sortable-list">
                    <div th:each="comp, cStat : *{companies}" class="list-item bg-light border p-3 mb-4 rounded-3">
                        <div class="d-flex align-items-center mb-3">
                            <i class="bi bi-grip-vertical drag-handle fs-4 me-2"></i>
                            <input type="hidden" th:field="*{companies[__${cStat.index}__].id}">
                            <input type="hidden" class="sort-order" th:field="*{companies[__${cStat.index}__].sortOrder}">

                            <div class="flex-grow-1 me-3"><input type="text" th:field="*{companies[__${cStat.index}__].name}" class="form-control fw-bold fs-5" placeholder="ÌöåÏÇ¨Î™Ö"></div>
                            <div class="mx-3 border-start ps-3 d-flex align-items-center">
                                <span class="badge bg-secondary me-2">TYPE</span>

                                <div class="form-check form-check-inline mb-0">
                                    <input class="form-check-input" type="radio" th:field="*{companies[__${cStat.index}__].type}" value="WORK" id="typeWork-${cStat.index}" checked>
                                    <label class="form-check-label small" th:for="${'typeWork-' + cStat.index}">WORK</label>
                                </div>

                                <div class="form-check form-check-inline mb-0">
                                    <input class="form-check-input" type="radio" th:field="*{companies[__${cStat.index}__].type}" value="PERSONAL" id="typePersonal-${cStat.index}">
                                    <label class="form-check-label small" th:for="${'typePersonal-' + cStat.index}">PERSONAL</label>
                                </div>
                            </div>
                            <div class="form-check form-switch" title="ÌöåÏÇ¨ ÎÖ∏Ï∂ú Ïó¨Î∂Ä">
                                <input class="form-check-input" type="checkbox" th:checked="${comp.visible}" onchange="this.nextElementSibling.value = this.checked">
                                <input type="hidden" th:field="*{companies[__${cStat.index}__].visible}">
                            </div>
                            <button type="button" class="btn btn-outline-danger btn-sm ms-3" onclick="removeElement(this)">ÏÇ≠Ï†ú</button>
                        </div>

                        <div th:id="'projectList-' + ${cStat.index}" class="project-sortable-list bg-white p-3 rounded border shadow-sm">
                            <div th:each="proj, pStat : ${comp.projects}" class="project-item border-bottom pb-4 mb-4">
                                <div class="d-flex align-items-center mb-2 bg-light p-2 rounded">
                                    <i class="bi bi-grip-vertical drag-handle me-2 text-secondary"></i>
                                    <span class="badge bg-primary me-2">PROJECT</span>
                                    <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].id}">
                                    <input type="hidden" class="project-sort-order" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].sortOrder}">
                                    <input type="text" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].title}" class="form-control fw-bold border-0 bg-transparent" placeholder="ÌîÑÎ°úÏ†ùÌä∏Î™Ö">

                                    <div class="form-check form-switch ms-2">
                                        <input class="form-check-input" type="checkbox" th:checked="${proj.visible}" onchange="this.nextElementSibling.value = this.checked">
                                        <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].visible}">
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removeElement(this)"><i class="bi bi-trash"></i></button>
                                </div>

                                <div th:id="'metaList-' + ${cStat.index} + '-' + ${pStat.index}" class="meta-sortable-list ps-3 border-start ms-2">
                                    <div th:each="meta, mStat : ${proj.metaItems}" class="meta-item mb-3 bg-white border rounded p-2">
                                        <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].id}">
                                        <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].itemType}">
                                        <input type="hidden" class="meta-sort-order" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].sortOrder}">

                                        <div class="d-flex align-items-center mb-2 border-bottom pb-1">
                                            <i class="bi bi-grip-horizontal drag-handle me-2"></i>
                                            <span class="badge bg-light text-dark border me-auto" th:text="${meta.itemType}"></span>
                                            <div class="form-check form-switch form-check-sm">
                                                <input class="form-check-input" type="checkbox" th:checked="${meta.visible}" onchange="this.nextElementSibling.value = this.checked">
                                                <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].visible}">
                                            </div>
                                        </div>

                                        <div th:if="${meta.itemType.toString() == 'DURATION'}"><input type="text" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].content}" class="form-control form-control-sm border-0" placeholder="Í∏∞Í∞Ñ"></div>
                                        <div th:if="${meta.itemType.toString() == 'SUMMARY'}"><textarea th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].content}" class="form-control form-control-sm border-0" rows="2" placeholder="ÏöîÏïΩ"></textarea></div>
                                        <div th:if="${meta.itemType.toString() == 'TECH_STACK_GROUP'}">
                                            <div th:id="'techList-' + ${cStat.index} + '-' + ${pStat.index} + '-' + ${mStat.index}" class="tech-sortable-list d-flex flex-wrap gap-2">

                                                <div th:each="stack, tStat : ${meta.techStacks}" class="tech-item input-group input-group-sm w-auto">
                                                    <span class="input-group-text bg-light border-0 px-1 drag-handle">::</span>

                                                    <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].techStacks[__${tStat.index}__].id}">
                                                    <input type="hidden" class="tech-sort-order" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].techStacks[__${tStat.index}__].sortOrder}">

                                                    <input type="text" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].techStacks[__${tStat.index}__].techName}" class="form-control" placeholder="Í∏∞Ïà†">

                                                    <div class="input-group-text bg-white border-start-0 ps-1">
                                                        <input class="form-check-input mt-0" type="checkbox"
                                                               th:checked="${stack.visible}"
                                                               onchange="this.nextElementSibling.value=this.checked; syncAllSkills();">

                                                        <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].techStacks[__${tStat.index}__].visible}">
                                                    </div>

                                                    <button type="button" class="btn btn-outline-secondary" onclick="removeElement(this)">x</button>
                                                </div>

                                            </div>
                                            <button type="button" class="btn btn-sm btn-link p-0 mt-2" th:onclick="'addTechStack(' + ${cStat.index} + ',' + ${pStat.index} + ',' + ${mStat.index} + ')'">+ Í∏∞Ïà†</button>
                                        </div>
                                        <div th:if="${meta.itemType.toString() == 'CONTENT_GROUP'}">
                                            <div th:id="'probList-' + ${cStat.index} + '-' + ${pStat.index} + '-' + ${mStat.index}">
                                                <div th:each="prob, probStat : ${meta.problems}" class="mb-3 ps-3 border-start border-3 border-light episode-item">
                                                    <div class="mb-2 d-flex align-items-center">
                                                        <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].id}">
                                                        <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].sortOrder}">
                                                        <input type="text" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].title}" class="form-control form-control-sm fw-bold bg-light" placeholder="Î¨∏Ï†ú Ï†ïÏùò">
                                                        <button type="button" class="btn btn-xs btn-link text-danger ms-2 text-decoration-none" onclick="removeElement(this)">ÏÇ≠Ï†ú</button>
                                                    </div>
                                                    <div th:id="'solList-' + ${cStat.index} + '-' + ${pStat.index} + '-' + ${mStat.index} + '-' + ${probStat.index}" class="solution-sortable-list ps-3 mb-1">
                                                        <div th:each="sol, solStat : ${prob.solutions}" class="solution-item input-group input-group-sm mb-1">
                                                            <span class="input-group-text bg-white border-0 px-1 drag-handle" style="cursor:move;">::</span>
                                                            <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].solutions[__${solStat.index}__].id}">
                                                            <input type="hidden" class="solution-sort-order" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].solutions[__${solStat.index}__].sortOrder}">
                                                            <input type="text" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].solutions[__${solStat.index}__].content}" class="form-control" placeholder="Ìï¥Í≤∞Ï±Ö">
                                                            <div class="input-group-text bg-white border-start-0 ps-1"><input class="form-check-input mt-0" type="checkbox" th:checked="${sol.visible}" onchange="this.nextElementSibling.value=this.checked"><input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].solutions[__${solStat.index}__].visible}"></div>
                                                            <button type="button" class="btn btn-outline-light text-danger border-0" onclick="removeElement(this)">x</button>
                                                        </div>
                                                    </div>
                                                    <div class="ps-4 mb-2"><button type="button" class="btn btn-xs btn-light text-primary py-0" th:onclick="'addSolution(' + ${cStat.index} + ',' + ${pStat.index} + ',' + ${mStat.index} + ',' + ${probStat.index} + ')'">+ Ìï¥Í≤∞Ï±Ö</button></div>
                                                    <div th:id="'impList-' + ${cStat.index} + '-' + ${pStat.index} + '-' + ${mStat.index} + '-' + ${probStat.index}" class="impact-sortable-list ps-3">
                                                        <div th:each="imp, impStat : ${prob.impacts}" class="impact-item input-group input-group-sm mb-1">
                                                            <span class="input-group-text bg-white border-0 px-1 drag-handle" style="cursor:move;">::</span>
                                                            <input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].impacts[__${impStat.index}__].id}">
                                                            <input type="hidden" class="impact-sort-order" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].impacts[__${impStat.index}__].sortOrder}">
                                                            <input type="text" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].impacts[__${impStat.index}__].content}" class="form-control" placeholder="ÏÑ±Í≥º">
                                                            <div class="input-group-text bg-white border-start-0 ps-1"><input class="form-check-input mt-0" type="checkbox" th:checked="${imp.visible}" onchange="this.nextElementSibling.value=this.checked"><input type="hidden" th:field="*{companies[__${cStat.index}__].projects[__${pStat.index}__].metaItems[__${mStat.index}__].problems[__${probStat.index}__].impacts[__${impStat.index}__].visible}"></div>
                                                            <button type="button" class="btn btn-outline-light text-danger border-0" onclick="removeElement(this)">x</button>
                                                        </div>
                                                    </div>
                                                    <div class="ps-4"><button type="button" class="btn btn-xs btn-light text-success py-0" th:onclick="'addImpact(' + ${cStat.index} + ',' + ${pStat.index} + ',' + ${mStat.index} + ',' + ${probStat.index} + ')'">+ ÏÑ±Í≥º</button></div>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-sm btn-outline-secondary w-100 mt-2" th:onclick="'addProblem(' + ${cStat.index} + ',' + ${pStat.index} + ',' + ${mStat.index} + ')'">+ ÏóêÌîºÏÜåÎìú</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-end mt-3"><button type="button" class="btn btn-primary btn-sm" th:onclick="'addFullProject(' + ${cStat.index} + ')'">+ ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä</button></div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary btn-sm mt-3" onclick="addCompany()">+ Í≤ΩÎ†•(ÌöåÏÇ¨) Ï∂îÍ∞Ä</button>
            </div>

            <div th:if="${sec.sectionType.name() == 'EDUCATION'}">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="fw-bold text-muted mb-0">ÌïôÎ†• Ï†ïÎ≥¥</h6>
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addEducation()">+ ÌïôÎ†• Ï∂îÍ∞Ä</button>
                </div>

                <div id="educationList" class="sortable-list">

                    <div th:each="edu, eStat : *{educations}" class="list-item bg-light border p-3 mb-3 rounded position-relative">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-grip-vertical drag-handle me-2 fs-5"></i>

                            <input type="hidden" th:field="*{educations[__${eStat.index}__].id}">
                            <input type="hidden" class="sort-order" th:field="*{educations[__${eStat.index}__].sortOrder}">

                            <h6 class="mb-0 fw-bold">ÌïôÎ†• ÏÉÅÏÑ∏</h6>

                            <div class="ms-auto d-flex align-items-center">
                                <div class="form-check form-switch me-2">
                                    <input class="form-check-input" type="checkbox"
                                           th:checked="${edu.visible}"
                                           onchange="this.nextElementSibling.value = this.checked">
                                    <input type="hidden" th:field="*{educations[__${eStat.index}__].visible}">
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeElement(this)">ÏÇ≠Ï†ú</button>
                            </div>
                        </div>

                        <div class="row g-2">
                            <div class="col-md-6">
                                <label class="form-label small text-muted mb-0">ÌïôÍµêÎ™Ö</label>
                                <input type="text" th:field="*{educations[__${eStat.index}__].institution}" class="form-control form-control-sm" placeholder="Ïòà: ÌïúÍµ≠ÎåÄÌïôÍµê">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small text-muted mb-0">Ï†ÑÍ≥µ</label>
                                <input type="text" th:field="*{educations[__${eStat.index}__].major}" class="form-control form-control-sm" placeholder="Ïòà: Ïª¥Ìì®ÌÑ∞Í≥µÌïô">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small text-muted mb-0">ÌïôÏ†ê</label>
                                <input type="text" th:field="*{educations[__${eStat.index}__].gpa}" class="form-control form-control-sm" placeholder="Ïòà: 4.0/4.5">
                            </div>
                            <div class="col-12">
                                <label class="form-label small text-muted mb-0">Í∏∞Í∞Ñ</label>
                                <input type="text" th:field="*{educations[__${eStat.index}__].period}" class="form-control form-control-sm" placeholder="Ïòà: 2015.03 - 2022.02">
                            </div>
                            <div class="col-12">
                                <label class="form-label small text-muted mb-0">Ï∂îÍ∞Ä Ï†ïÎ≥¥ (ÏÑ†ÌÉù)</label>
                                <textarea th:field="*{educations[__${eStat.index}__].additionalInfo}" class="form-control form-control-sm" rows="2" placeholder="Ï°∏ÏóÖ ÎÖºÎ¨∏ Ï£ºÏ†ú Îì±"></textarea>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div th:if="${sec.sectionType.name() == 'CERTIFICATION'}">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="fw-bold text-muted mb-0">ÏûêÍ≤©Ï¶ù / Ïñ¥Ìïô</h6>
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addCertification()">+ ÏûêÍ≤©Ï¶ù Ï∂îÍ∞Ä</button>
                </div>

                <div id="certificationList" class="sortable-list">

                    <div th:each="cert, certStat : *{certifications}" class="list-item bg-light border p-3 mb-2 rounded position-relative">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-grip-vertical drag-handle me-2 fs-5"></i>

                            <input type="hidden" th:field="*{certifications[__${certStat.index}__].id}">
                            <input type="hidden" class="sort-order" th:field="*{certifications[__${certStat.index}__].sortOrder}">

                            <h6 class="mb-0 fw-bold">ÏûêÍ≤©Ï¶ù Ï†ïÎ≥¥</h6>

                            <div class="ms-auto d-flex align-items-center">
                                <div class="form-check form-switch me-2">
                                    <input class="form-check-input" type="checkbox"
                                           th:checked="${cert.visible}"
                                           onchange="this.nextElementSibling.value = this.checked">
                                    <input type="hidden" th:field="*{certifications[__${certStat.index}__].visible}">
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeElement(this)">ÏÇ≠Ï†ú</button>
                            </div>
                        </div>

                        <div class="row g-2">
                            <div class="col-md-8">
                                <label class="form-label small text-muted mb-0">ÏûêÍ≤©Ï¶ùÎ™Ö</label>
                                <input type="text" th:field="*{certifications[__${certStat.index}__].name}" class="form-control form-control-sm" placeholder="Ïòà: Ï†ïÎ≥¥Ï≤òÎ¶¨Í∏∞ÏÇ¨">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small text-muted mb-0">Ï∑®ÎìùÏùº</label>
                                <input type="text" th:field="*{certifications[__${certStat.index}__].issueDate}" class="form-control form-control-sm" placeholder="Ïòà: 2023.05">
                            </div>
                            <div class="col-12">
                                <label class="form-label small text-muted mb-0">Ï∂îÍ∞Ä Ï†ïÎ≥¥ (ÏÑ†ÌÉù)</label>
                                <textarea th:field="*{certifications[__${certStat.index}__].additionalInfo}" class="form-control form-control-sm" rows="1" placeholder="Î∞úÍ∏âÍ∏∞Í¥ÄÏù¥ÎÇò ÏûêÍ≤©Ï¶ù Î≤àÌò∏ Îì±"></textarea>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div th:if="${sec.sectionType.name() == 'SKILLS'}">

                <div class="row">
                    <div class="col-md-4 border-end">
                        <h6 class="fw-bold text-muted mb-3">
                            <i class="bi bi-magic"></i> Í∞êÏßÄÎêú Í∏∞Ïà† Ïä§ÌÉù
                            <small class="d-block fw-normal text-secondary" style="font-size:0.75rem">
                                ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑú ÏÇ¨Ïö©Îêú Í∏∞Ïà† Ï§ë ÏïÑÏßÅ Î∂ÑÎ•òÎêòÏßÄ ÏïäÏùÄ Ìï≠Î™©Îì§ÏûÖÎãàÎã§. Ïò§Î•∏Ï™ΩÏúºÎ°ú ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî.
                            </small>
                        </h6>

                        <div class="input-group input-group-sm mb-3">
                            <input type="text" id="manualSkillInput" class="form-control" placeholder="ÏßÅÏ†ë Ïä§ÌÇ¨ Ï∂îÍ∞Ä">
                            <button class="btn btn-outline-secondary" type="button" onclick="addManualSkillToPool()">Ï∂îÍ∞Ä</button>
                        </div>

                        <div id="detectedSkillPool" class="d-flex flex-wrap gap-2 p-2 bg-light rounded border" style="min-height: 100px;">
                            <div th:each="tech : *{detectedSkills}" class="skill-chip badge bg-white text-dark border p-2 shadow-sm" style="cursor: move;">
                                <span class="skill-name" th:text="${tech}">Java</span>
                                <input type="hidden" class="skill-name-input" th:value="${tech}">
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="fw-bold text-muted mb-0">Íµ¨ÏÑ±Îêú Ïä§ÌÇ¨ÏÖã</h6>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSkillCategory()">
                                + ÏÉà Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä
                            </button>
                        </div>

                        <div id="skillCategoryList" class="sortable-list">
                            <div th:each="cat, catStat : *{skillCategories}" class="list-item card mb-3 bg-white border">
                                <div class="card-header bg-light d-flex align-items-center py-2">
                                    <i class="bi bi-grip-vertical drag-handle me-2 text-secondary"></i>

                                    <input type="hidden" th:field="*{skillCategories[__${catStat.index}__].id}">
                                    <input type="hidden" class="sort-order" th:field="*{skillCategories[__${catStat.index}__].sortOrder}">

                                    <input type="text" th:field="*{skillCategories[__${catStat.index}__].name}"
                                           class="form-control form-control-sm fw-bold border-0 bg-transparent"
                                           style="width: 300px;"
                                           placeholder="Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö (Ïòà: Backend)">

                                    <div class="ms-auto d-flex align-items-center">
                                        <div class="form-check form-switch me-2">
                                            <input class="form-check-input" type="checkbox" th:checked="${cat.visible}" onchange="this.nextElementSibling.value=this.checked">
                                            <input type="hidden" th:field="*{skillCategories[__${catStat.index}__].visible}">
                                        </div>
                                        <button type="button" class="btn btn-xs btn-outline-danger border-0" onclick="removeElement(this)"><i class="bi bi-trash"></i></button>
                                    </div>
                                </div>

                                <div class="card-body p-2">
                                    <div th:id="'catSkillList-' + ${catStat.index}" class="skill-sortable-list d-flex flex-wrap gap-2" style="min-height: 40px;">

                                        <div th:each="skill, sStat : ${cat.skills}" class="skill-item badge bg-primary text-white p-2 d-flex align-items-center" style="cursor: move;">
                                            <input type="hidden" th:field="*{skillCategories[__${catStat.index}__].skills[__${sStat.index}__].id}">
                                            <input type="hidden" class="skill-sort-order" th:field="*{skillCategories[__${catStat.index}__].skills[__${sStat.index}__].sortOrder}">
                                            <input type="hidden" th:field="*{skillCategories[__${catStat.index}__].skills[__${sStat.index}__].visible}">

                                            <span class="me-2" th:text="${skill.name}">Java</span>
                                            <input type="hidden" th:name="|skillCategories[${catStat.index}].skills[${sStat.index}].name|" th:value="${skill.name}">

                                            <i class="bi bi-x-circle-fill ms-1 text-white-50" style="cursor: pointer;" onclick="removeElement(this)"></i>
                                        </div>
                                    </div>
                                    <div class="text-center mt-2">
                                        <small class="text-muted" style="font-size: 0.7rem;">Ïó¨Í∏∞Î°ú Ïä§ÌÇ¨ÏùÑ ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div> </div> <div class="fixed-bottom bg-white border-top p-3 text-center shadow" style="z-index: 1000;">
    <button type="submit" class="btn btn-primary btn-lg rounded-pill px-5">Ï†ÑÏ≤¥ Ï†ÄÏû•ÌïòÍ∏∞</button>
</div>

</form>

<script th:src="@{/js/profile-editor.js}"></script>

</body>
</html>